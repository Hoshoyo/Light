#import "../examples/windows/windows.li"

main : () -> s32 {
	a := /*#run*/ foo();
	return a;
}

foo : () -> s32 {
    window_class : WNDCLASSEXA;
	window_class.cb_size = #size_of WNDCLASSEXA -> u32;
	window_class.style = 0;
	window_class.wndproc = window_callback;//null -> (^void, u32, ^u32, ^u32) -> ^void;
	window_class.cb_cls_extra = 0;
	window_class.cb_wnd_extra = 0;
	window_class.h_instance = null;
	window_class.h_icon = null;
	window_class.h_cursor = null;
	window_class.h_brush = null;
	window_class.menu_name = null;
	window_class.class_name = "MyClass\0".data;
	window_class.icon_sm = null;

    if RegisterClassExA(&window_class) == 0
        return GetLastError();

	w := CreateWindowExA(0x00000100|0x00000200, 
			window_class.class_name, 
			"MyWindow\0".data, 
			0x00C00000|0x00080000|0x00040000|0x00020000|0x00010000|0x10000000, 
        	100, 
			100, 
			1024, 
			768, 
			null, 
			null, 
			null, 
			null);
	
	if w == null
		return GetLastError();
	
	msg : MSG;
    while GetMessageA(&msg, w, 0, 0) != 0
    {
		TranslateMessage(&msg);
		DispatchMessageA(&msg);
    }

    return 33;
}

window_callback : (window : ^void, msg : u32, lparam: ^u32, wparam: ^u32) -> ^void #extern {
	if msg == WM_CLOSE {
		ExitProcess(0);
	} else {
		a := DefWindowProcA(window, msg, lparam, wparam);
		return a;
	}
	
	return null;
}

#import "../modules/w_print.li"